# TODO: deployë¡œ í• ì§€ buildë¡œ ë‚˜ëˆŒì§€ ê³ ë¯¼
# TODO: íŒŒì¼ëª… ì •í•˜ê¸°
# TODO: ì´ë¯¸ì§€ ì´ë¦„ ì •í•˜ê¸°
name: ğŸš€ API Deploy

on:
  push:
    branches:
      - main
    paths:
      - api/src/main/**

jobs:
  build:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      packages: write
    env:
      java-version: 17
      jar-artifact-name: api-jar
    steps:
      - name: ğŸ”¢ Generate Version
        id: version
        uses: ./cicd/headver
        with:
          head: 1 # TODO
          build: ${{ github.run_number }}

      - name: â˜•ï¸ Build and upload JAR file
        uses: ./cicd/api/build-jar-file
        with:
          build-root-directory: api
          upload-artifact-name: ${{ env.jar-artifact-name }}
          java-version: ${{ env.java-version }}

      - name: ğŸ³ Build and push Docker image
        uses: ./cicd/api/build-docker-image
        with:
          registry: ghcr.io
          image-name: pancake-api
          build-version: ${{ steps.version.outputs.version }}
          java-version: ${{ env.java-version }}
          jar-artifact-name: ${{ env.jar-artifact-name }}